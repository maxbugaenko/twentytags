<div class="list-container">
    <div class="list"'>
        <div class="column-width"></div>
        <? foreach ($this->paginator as $item):?>
            <div class="item">
                <div class="item-image">
                    <a href="<?=$this->url(array("id"=>$item, Model_Static_Functions::dashString($item->title)=>""), "entity", false)?>">
                        <img title="<?=$item->title?>" src="<?=$this->staticFile("images/entities/".$item->picture)?>">
                    </a>
                </div>
                <div class="item-content">
                    <div class="item-title">
                        <a class="red-link" title="<?=$item->title?>" href="<?=$this->url(array("id"=>$item, Model_Static_Functions::dashString($item->title)=>""), "entity", false)?>"><?=$item->title?></a><br/>
                    </div>
                    <div class="item-tags">
                        <?$tagged = Model_Tag::retrieveTaggedTagsByEntity($item);?>
                        <? foreach ($tagged as $tag):?>
                            <a class="gray-link link-underline" href="<?=$this->url(array("id"=>$tag, Model_Static_Functions::dashString($tag->value)=>""), "tags", false)?>"><?=$tag->value?></a>
                        <? endforeach?>
                    </div>
                    <div class="item-description">
                        <?=$item->description?>&#160;&#160;&#160;
                        <? if ($item->link):?>
                            <a class="gray-link" href="<?=$item->link?>">
                                <i title="<?=$item->title?> on the web" class="fa fa-external-link-square"></i>
                            </a>
                        <?endif?>
                    </div>
                    <div class="item-info">
                        <? $alertCount = Model_Alert::retrieveCountByEntity($item);?>
                        <? if ($alertCount > 0):?>
                            <span class="item-badge-total" title="<?=$alertCount?> updates total">
                                <?=$alertCount?>
                            </span>
                        <?endif?>
                        <?if (($todayAlertCount = Model_Alert::retrieveTodayCountByEntity($item)) > 0) :?>
                            <span class="item-badge-today" title="<?=$todayAlertCount?> new articles today">
                                <?=$todayAlertCount?>
                            </span>
                        <? endif ?>

                    </div>
                </div>
                <? $isSaved = Model_Entity::isSaved($item);?>
                <div id="item-follow-button-<?=$item?>" class="item-follow-button <?=$isSaved == true ? "make-visible":""?>">
                    <button id="follow-<?=$item?>" class="to-follow-button button-small <?=$isSaved ? "button-gray followed":""?>">
                        <i class="fa fa-check-circle"></i> <?=$isSaved ? "Unfollow":"Follow"?>
                    </button>
                </div>
            </div>
        <?endforeach?>
    </div>
</div>
<script>
    $(".to-follow-button").FollowEntity();
    window.onload = function(){
        var $container = $('.list').masonry({
            itemSelector: '.item',
            columnWidth: '.column-width'
        });
    }
</script>